L4 접속

Cybill_L4_M
donquis // rnjsguswls`1@#
en
password : rnjsguswls`1@#

#############################################################################################################################

Connecting to 172.18.245.5:22...
Connection established.
To escape to local shell, press 'Ctrl+Alt+]'.

________________________________________________________
!!!! WARNING !!!! WARNING !!!! WARNING !!!! WARNING !!!!
--------------------------------------------------------

Warning!  Unauthorized use of this system is prohibited.
You will be prosceuted to the fullest extent of the law.

________________________________________________________
!!!! WARNING !!!! WARNING !!!! WARNING !!!! WARNING !!!!
--------------------------------------------------------

WARNING! The remote SSH server rejected X11 forwarding request.
SSH@CyBill_L4_M>
SSH@CyBill_L4_M>
SSH@CyBill_L4_M>en
Password:**************

SSH@CyBill_L4_M#show server bind ebo-mem-80

Bind info

Virtual server: ebo-mem-80               Status: enabled  IP: 120.50.136.10
                                         symmetric VIP state: Owner
        http -------> ebo-mem01: 172.18.245.20,  http (Active)
                      ebo-mem02: 172.18.245.21,  http (Active)
                      ebo-mem03: 172.18.245.22,  http (User Disabled)
                      cymem-g01: 172.18.245.46,  http (User Disabled)
                      cymem-g02: 172.18.245.47,  http (User Disabled)
                      cymem-g03: 172.18.245.48,  http (Active)
                      cymem-g04: 172.18.245.49,  http (Active)
         ssl -------> ebo-mem01: 172.18.245.20,  ssl (Active)
                      ebo-mem02: 172.18.245.21,  ssl (Active)
                      ebo-mem03: 172.18.245.22,  ssl (User Disabled)
                      cymem-g01: 172.18.245.46,  ssl (User Disabled)
                      cymem-g02: 172.18.245.47,  ssl (User Disabled)
                      cymem-g03: 172.18.245.48,  ssl (Active)
                      cymem-g04: 172.18.245.49,  ssl (Active)


서버는 켜져 있지만 빠져 있는 이유는 SK컴즈와 통신이 안되기 때문에 L4에서 빼놨음
#############################################################################################################################





#Build server
cyebo-dev01(192.168.249.158)
build cymember yiseungju dltmdwn@42 live


#L4 configuration
show server bind ebo-mem-80

config t
server real 172.18.245.20
dis
server real 172.18.245.21
dis
end
show server bind ebo-mem-80

config t
server real 172.18.245.20
no dis
server real 172.18.245.21
no dis
end
show server bind ebo-mem-80

=================================================================================

config t
server real 172.18.245.48
dis
server real 172.18.245.49
dis
end
show server bind ebo-mem-80

config t
server real 172.18.245.48
no dis
server real 172.18.245.49
no dis
end
show server bind ebo-mem-80
==

#deploy
cd /root/deploy
./deploy.pl

file : ROOT.war
nginx passwd : cyworld



root@ebo-mem01:/root/deploy># ./deploy.pl 
This script is excuted by
c0131    pts/0        2017-12-07 15:26 (10.42.0.142)

=============================================================
 cyworld stage 로 부터 배포 파일을 가져와 배포후 데몬 재시작  
  
 0. 배포 파일명 입력  
 1. 서비스 제외 및 커넥션 체크 
 2. nginx 중지 및 포트 체크 
 3. resin (1st) 중지 및 포트 체크 
 4. resin (2nd) 중지 및 포트 체크 
 5. rsync 진행 
 6. nginx 시작 및 포트 체크 
 7. resin (1st) 시작 및 포트 체크 
 8. resin (2nd) 시작 및 포트 체크 
 9. 서비스 재투입 및 커넥션 모니터링 
=============================================================

(ex): <filename1> <filename2> ...
> Stage deploy file name or path: ROOT.war
> Do you wish to continue? (y/n): y
 

#### (1/9) INPUT ip chains to stop service ####
iptables -F 
iptables -A INPUT -s 127.0.0.1 -j ACCEPT 
iptables -A INPUT -s 10.243.0.0/10.243.3.255 -p tcp --dport 80,443 -j ACCEPT 
iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED --dport 80,443 -j ACCEPT 
iptables -A INPUT -p tcp -m state --state NEW --dport 80,443 -j DROP 
iptables v1.4.7: invalid port/service `80,443' specified
Try `iptables -h' or 'iptables --help' for more information.
iptables v1.4.7: invalid port/service `80,443' specified
Try `iptables -h' or 'iptables --help' for more information.
iptables v1.4.7: invalid port/service `80,443' specified
Try `iptables -h' or 'iptables --help' for more information.


#### (2/9) Stop nginx Service daemon #### 
/skcomms/nginx/bin/nginx stop 
nginx 를 정지 중:                                          [  OK  ]
stoppted!! 


#### (3/9) Stop 1st resin service daemon #### 
/skcomms/resin/bin/resinctl stop -server app1-0 
Resin/4.0.38 stopped -server 'app1-0' for watchdog at 127.0.0.1:6600
stoppted!! 


#### (4/9) Stop 2nd resin service daemon #### 
/skcomms/resin/bin/resinctl stop -server app2-0 
Resin/4.0.38 stopped -server 'app2-0' for watchdog at 127.0.0.1:6600
stoppted!! 


#### (5/9) Rsync start from stage server ####
for i in ROOT.war; do /usr/bin/rsync -av 192.168.249.158::MEM_DEPLOY/$i /skcomms/resin/webapps/app1/; done 
for i in ROOT.war; do /usr/bin/rsync -av 192.168.249.158::MEM_DEPLOY/$i /skcomms/resin/webapps/app2/; done 
receiving incremental file list
ROOT.war

sent 49562 bytes  received 1946938 bytes  1331000.00 bytes/sec
total size is 49961386  speedup is 25.02
receiving incremental file list
ROOT.war

sent 49562 bytes  received 1946938 bytes  1331000.00 bytes/sec
total size is 49961386  speedup is 25.02

> Press <Enter> key to continue....


#### (6/9) Start nginx service daemon #### 
/skcomms/nginx/bin/nginx start 
nginx (을)를 시작 중: Enter PEM pass phrase:
                                                           [  OK  ]
started!! 


#### (7/9) Start 1st resin service daemon #### 
/skcomms/resin/bin/resinctl start -server app1-0 
Resin/4.0.38 launching watchdog at 127.0.0.1:6600
Resin/4.0.38 started -server 'app1-0' with watchdog at 127.0.0.1:6600
..started!! 


#### (8/9) Start 2nd resin service daemon #### 
/skcomms/resin/bin/resinctl start -server app2-0 
Resin/4.0.38 started -server 'app2-0' with watchdog at 127.0.0.1:6600
..started!! 

> Are you sure this server is ready to service? (y/n): y


#### (9/9) FLUSH ip chains to start service ####
iptables -F 

=============================================================
                         배포 종료
=============================================================














SSH@CyBill_L4_M#show server bind ebo-mem-80

Bind info

Virtual server: ebo-mem-80               Status: enabled  IP: 120.50.136.10
                                         symmetric VIP state: Owner
        http -------> ebo-mem01: 172.18.245.20,  http (Active)
                      ebo-mem02: 172.18.245.21,  http (Active)
                      ebo-mem03: 172.18.245.22,  http (User Disabled)
                      cymem-g01: 172.18.245.46,  http (User Disabled)
                      cymem-g02: 172.18.245.47,  http (User Disabled)
                      cymem-g03: 172.18.245.48,  http (Active)
                      cymem-g04: 172.18.245.49,  http (Active)
         ssl -------> ebo-mem01: 172.18.245.20,  ssl (Active)
                      ebo-mem02: 172.18.245.21,  ssl (Active)
                      ebo-mem03: 172.18.245.22,  ssl (User Disabled)
                      cymem-g01: 172.18.245.46,  ssl (User Disabled)
                      cymem-g02: 172.18.245.47,  ssl (User Disabled)
                      cymem-g03: 172.18.245.48,  ssl (Active)
                      cymem-g04: 172.18.245.49,  ssl (Active)
SSH@CyBill_L4_M#
